{% extends 'base.html' %}

{% block content %}
<h2>Applicants for: {{ job.title }}</h2>
<a href="{% url 'hr_dashboard' %}" class="btn btn-outline-secondary mb-3">Back to Dashboard</a>

<style>
    .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        border-radius: 16px;
    }

    [data-bs-theme="dark"] .glass-card {
        background: rgba(30, 32, 40, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
    }

    .table-container {
        border-radius: 16px;
        overflow: hidden;
    }

    [data-bs-theme="dark"] .table {
        color: #e0e0e0;
        border-color: rgba(255, 255, 255, 0.1);
    }

    [data-bs-theme="dark"] .table-light {
        background-color: rgba(255, 255, 255, 0.05);
        color: #fff;
    }

    [data-bs-theme="dark"] .table-hover tbody tr:hover {
        background-color: rgba(255, 255, 255, 0.05);
    }

    .theme-modal-content {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    [data-bs-theme="dark"] .theme-modal-content {
        background: rgba(30, 32, 40, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .action-btn {
        width: 32px;
        height: 32px;
        padding: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        transition: transform 0.2s;
    }

    .action-btn:hover {
        transform: translateY(-2px);
    }
</style>

<div class="glass-card p-4">
    <div class="table-container">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th class="ps-4">Candidate</th>
                    <th>Contact</th>
                    <th>Start Date</th>
                    <th>Rank Score</th>
                    <th>Status</th>
                    <th class="text-end pe-4">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for app in applications %}
                <tr>
                    <td class="ps-4">
                        <div class="d-flex align-items-center">
                            <div class="bg-primary-subtle text-primary rounded-circle d-flex align-items-center justify-content-center me-3"
                                style="width: 40px; height: 40px; font-weight: bold;">
                                {{ app.full_name|first|default:app.user.username|first|upper }}
                            </div>
                            <div>
                                <div class="fw-bold">{{ app.full_name|default:app.user.username }}</div>
                                <div class="small text-muted">{{ app.email }}</div>
                            </div>
                        </div>
                    </td>
                    <td>{{ app.phone|default:"-" }}</td>
                    <td><span class="badge bg-light text-dark border">{{ app.start_date|date:"M d, Y"|default:"-"
                            }}</span></td>
                    <td>
                        <div class="d-flex align-items-center gap-2">
                            <div class="progress flex-grow-1" style="height: 6px; width: 60px;">
                                <div class="progress-bar {% if app.ranking_score > 70 %}bg-success{% elif app.ranking_score > 40 %}bg-warning{% else %}bg-danger{% endif %}"
                                    role="progressbar" style="width: {{ app.ranking_score|default:0 }}%;"
                                    aria-valuenow="{{ app.ranking_score|default:0 }}" aria-valuemin="0"
                                    aria-valuemax="100">
                                </div>
                            </div>
                            <span class="small fw-bold">{{ app.ranking_score|floatformat:2 }}%</span>
                        </div>
                    </td>
                    <td>
                        {% if app.status == 'Pending' %}
                        <span class="badge bg-warning-subtle text-warning border border-warning">Pending</span>
                        {% elif app.status == 'Accepted' %}
                        <span class="badge bg-success-subtle text-success border border-success">Accepted</span>
                        {% elif app.status == 'Rejected' %}
                        <span class="badge bg-danger-subtle text-danger border border-danger">Rejected</span>
                        {% endif %}
                    </td>
                    <td class="text-end pe-4">
                        <div class="d-inline-flex gap-1">
                            {% if app.status == 'Pending' %}
                            <a href="{% url 'update_application_status' app.id 'Accepted' %}"
                                class="action-btn btn-success text-white shadow-sm" title="Accept">
                                <i class="fas fa-check fa-sm"></i>
                            </a>
                            <a href="{% url 'update_application_status' app.id 'Rejected' %}"
                                class="action-btn btn-danger text-white shadow-sm" title="Reject">
                                <i class="fas fa-times fa-sm"></i>
                            </a>
                            {% endif %}
                            <button class="action-btn btn-info text-white shadow-sm" data-bs-toggle="modal"
                                data-bs-target="#appModal{{ app.id }}" title="View Details">
                                <i class="fas fa-eye fa-sm"></i>
                            </button>
                            <a href="{{ app.resume.url }}" target="_blank"
                                class="action-btn btn-primary text-white shadow-sm" title="Download Resume">
                                <i class="fas fa-download fa-sm"></i>
                            </a>
                        </div>
                    </td>
                </tr>

                <!-- Application Detail Modal -->
                <div class="modal fade" id="appModal{{ app.id }}" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content theme-modal-content border-0 shadow-lg rounded-4">
                            <div class="modal-header border-bottom border-light-subtle">
                                <h5 class="modal-title fw-bold">Candidate: {{ app.full_name }}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body p-4">
                                <div class="row g-4">
                                    <div class="col-md-6">
                                        <div class="p-3 bg-body-tertiary rounded-3 h-100">
                                            <h6 class="fw-bold text-uppercase small text-muted mb-3"><i
                                                    class="far fa-calendar-check me-2"></i>Availability</h6>
                                            <div class="mb-2">
                                                <small class="d-block text-muted">Interview Availability</small>
                                                <strong>{{ app.available_interview_date|date:"F j, Y, g:i
                                                    a"|default:"Not specified" }}</strong>
                                            </div>
                                            <div>
                                                <small class="d-block text-muted">Start Date</small>
                                                <strong>{{ app.start_date|date:"F j, Y"|default:"Immediate" }}</strong>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="p-3 bg-body-tertiary rounded-3 h-100">
                                            <h6 class="fw-bold text-uppercase small text-muted mb-3"><i
                                                    class="fas fa-chart-bar me-2"></i>AI Analysis</h6>
                                            <div class="mb-2">
                                                <small class="d-block text-muted">Rank Score</small>
                                                <h3
                                                    class="fw-bold {% if app.ranking_score > 70 %}text-success{% else %}text-warning{% endif %} m-0">
                                                    {{ app.ranking_score|floatformat:2 }}%</h3>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <h6 class="fw-bold text-uppercase small text-muted mb-2">Cover Letter</h6>
                                        <div class="p-3 bg-body-tertiary rounded-3 border border-light-subtle">
                                            {{ app.cover_letter|linebreaks|default:"No cover letter provided." }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer border-0">
                                <button type="button" class="btn btn-secondary rounded-pill px-4"
                                    data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-5 text-muted">
                        <i class="far fa-folder-open fa-3x mb-3 opacity-50"></i>
                        <p class="mb-0">No applications received yet.</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}